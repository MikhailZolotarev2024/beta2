<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>DeFi DEX-Terminal | Multi-wallet Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: monospace; background: #0d1117; color: #f0f0f0; padding: 20px; }
    input, select, button { margin: 6px 0; padding: 4px 6px; background: #161b22; color: #f0f0f0; border: 1px solid #30363d; }
    .section { border: 1px solid #30363d; padding: 15px; margin-bottom: 20px; }
    .highlight { color: #56d364; }
  </style>
</head>
<body>
<h1>üì° DEX-Terminal ‚Äî Multi-wallet Simulation</h1>
<div class="section">
  <h3>1Ô∏è‚É£ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–æ–≤</h3>
  <button onclick="connect('metamask')">üîå –ü–æ–¥–∫–ª—é—á–∏—Ç—å MetaMask</button>
  <button onclick="connect('trust')">üîê –ü–æ–¥–∫–ª—é—á–∏—Ç—å Trust Wallet</button>
  <div id="wallet-address">–ê–¥—Ä–µ—Å: ‚Äî</div>
</div>

<div class="section">
  <h3>2Ô∏è‚É£ –ë–∞–ª–∞–Ω—Å –∏ —Ç–æ–∫–µ–Ω—ã</h3>
  <button onclick="loadBalance()">üì• –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
  <div id="balance-output">–ë–∞–ª–∞–Ω—Å: ‚Äî</div>
</div>

<div class="section">
  <h3>3Ô∏è‚É£ Approve & TransferFrom</h3>
  <label>–ö–æ–Ω—Ç—Ä–∞–∫—Ç —Ç–æ–∫–µ–Ω–∞:</label><br>
  <input id="token-address" value="0xdAC17F958D2ee523a2206206994597C13D831ec7" style="width: 100%"><br>
  <label>–ü–æ–ª—É—á–∞—Ç–µ–ª—å (–±–∏—Ä–∂–∞):</label><br>
  <input id="spender-address" placeholder="0x..." style="width: 100%"><br>
  <label>–°—É–º–º–∞:</label><br>
  <input id="amount" type="number" step="0.0001"><br>
  <button onclick="approveToken()">‚úÖ Approve</button>
  <button onclick="transferFromToken()">üí∏ TransferFrom</button>
  <button onclick="checkAllowance()">üìñ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Allowance</button>
</div>

<div class="section">
  <h3>4Ô∏è‚É£ Permit (EIP-2612), Airdrop —Ñ–µ–π–∫–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤</h3>
  <button onclick="simulatePermit()">üß¨ –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å Permit</button>
  <button onclick="airdropFake()">üéÅ –§–µ–π–∫–æ–≤—ã–π Airdrop</button>
</div>

<div class="section">
  <h3>5Ô∏è‚É£ –õ–æ–≥</h3>
  <pre id="log"></pre>
</div>

<script>
let provider, signer, userAddress;

function log(text) {
  document.getElementById('log').textContent += text + "\n";
}

async function connect(type) {
  if (type === 'trust') {
    if (!window.ethereum || !window.ethereum.isTrust) return alert('Trust Wallet –Ω–µ –Ω–∞–π–¥–µ–Ω');
    provider = new ethers.BrowserProvider(window.ethereum);
  } else {
    if (!window.ethereum) return alert('MetaMask –Ω–µ –Ω–∞–π–¥–µ–Ω');
    provider = new ethers.BrowserProvider(window.ethereum);
  }
  await provider.send("eth_requestAccounts", []);
  signer = await provider.getSigner();
  userAddress = await signer.getAddress();
  document.getElementById('wallet-address').textContent = "–ê–¥—Ä–µ—Å: " + userAddress;
  log("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω: " + userAddress);
}

async function loadBalance() {
  const bal = await provider.getBalance(userAddress);
  document.getElementById('balance-output').textContent = `ETH: ${ethers.formatEther(bal)} ETH`;
  log("üìä –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—ë–Ω");
}

async function approveToken() {
  const tokenAddr = document.getElementById('token-address').value;
  const spender = document.getElementById('spender-address').value;
  const amount = document.getElementById('amount').value;
  const token = new ethers.Contract(tokenAddr, [
    "function approve(address,uint256) public returns(bool)"
  ], signer);
  const tx = await token.approve(spender, ethers.parseUnits(amount, 6));
  await tx.wait();
  log(`‚úÖ Approve ${amount} –¥–ª—è ${spender}`);
}

async function transferFromToken() {
  const tokenAddr = document.getElementById('token-address').value;
  const spender = document.getElementById('spender-address').value;
  const amount = document.getElementById('amount').value;
  const token = new ethers.Contract(tokenAddr, [
    "function transferFrom(address from, address to, uint256 amount) public returns(bool)"
  ], signer);
  const tx = await token.transferFrom(userAddress, spender, ethers.parseUnits(amount, 6));
  await tx.wait();
  log(`üí∏ TransferFrom ${amount} ‚Üí ${spender}`);
}

async function checkAllowance() {
  const tokenAddr = document.getElementById('token-address').value;
  const spender = document.getElementById('spender-address').value;
  const token = new ethers.Contract(tokenAddr, [
    "function allowance(address owner, address spender) view returns (uint256)"
  ], signer);
  const allowance = await token.allowance(userAddress, spender);
  log(`üìñ Allowance –¥–ª—è ${spender}: ${ethers.formatUnits(allowance, 6)} —Ç–æ–∫–µ–Ω–æ–≤`);
}

async function simulatePermit() {
  log("üß¨ Permit –∑–¥–µ—Å—å —Å–∏–º—É–ª–∏—Ä—É–µ—Ç—Å—è ‚Äî –æ–±—ã—á–Ω–æ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ off-chain –∏ relay...");
  log("(–≠—Ç–∞ —á–∞—Å—Ç—å —Ç—Ä–µ–±—É–µ—Ç EIP-2612 –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞)");
}

async function airdropFake() {
  log("üéÅ –ù–∞ –≤–∞—à MetaMask –±—É–¥–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–µ–π–∫–æ–≤—ã–π —Ç–æ–∫–µ–Ω...");
  await window.ethereum.request({
    method: 'wallet_watchAsset',
    params: {
      type: 'ERC20',
      options: {
        address: '0x1111111111111111111111111111111111111111',
        symbol: 'FAKEUSDT',
        decimals: 6,
        image: 'https://cryptologos.cc/logos/tether-usdt-logo.png'
      }
    }
  });
  log("‚úÖ FAKEUSDT –¥–æ–±–∞–≤–ª–µ–Ω –≤ MetaMask");
}
</script>
</body>
</html>
